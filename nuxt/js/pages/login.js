(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{899:function(e,r,t){"use strict";t.r(r);var o=t(24),n={auth:"guest",head:function(){return{title:"登陆 - Saiblo"}},data:function(){return{form:{method:"password",username:"",password:""},smsForm:{method:"sms",username:"",password:""},isLoading:!1,isOK:!1,passLogin:!0,smsSend:!1,smsContent:"发送验证码",smsTime:60,sms_err_code:0,err_code:0}},watch:{"form.username":function(){this.err_code=0},"form.password":function(){this.err_code=0},"smsForm.username":function(){this.err_code=0},"smsForm.password":function(){this.err_code=0}},mounted:function(){this.$refs.username.$refs.input.focus()},validations:{form:{username:{required:o.required},password:{required:o.required}},smsForm:{username:{required:o.required},password:{required:o.required}}},methods:{sendSMSCode:function(){var e=this;if(!/^[1][3,4,5,7,8][0-9]{9}$/.test(this.smsForm.username))return this.sms_err_code=1,void this.$notify.error({message:"请输入正确的11位手机号",title:"失败",timeout:1e3});this.$axios.post("/api/users/send_login_sms/",{phone_number:this.smsForm.username}).then((function(){e.sms_err_code=0,e.$notify.success({message:"发送验证码成功",title:"成功",timeout:1e3})})).catch((function(r){e.sms_err_code=r.response.status})).then((function(){e.smsSend=!0,e.smsContent=e.smsTime+"s后重发";var r=window.setInterval((function(){e.smsTime--,e.smsContent=e.smsTime+"s后重发",e.smsTime<0&&(window.clearInterval(r),e.smsContent="重发验证码",e.snsTime=60,e.smsSend=!1)}),1e3)}))},login:function(){var e=this;if(this.passLogin){if(this.$v.form.$touch(),this.$v.form.$invalid)return;this.isLoading=!0,this.$auth.loginWith("local",{data:this.form}).then((function(){e.err_code=0,e.isOK=!0,e.$notify.success({message:"登录成功",title:"成功",timeout:1e3})})).catch((function(r){e.err_code=r.response.status,401===e.err_code&&-1!==r.response.data.err_msg.indexOf("邮箱")?e.$router.push("/validate_email?username=".concat(e.form.username)):401===e.err_code&&-1!==r.response.data.err_msg.indexOf("手机")&&e.$router.push("/validate_phone?username=".concat(e.form.username))})).then((function(){e.isLoading=!1}))}else{if(this.$v.smsForm.$touch(),this.$v.smsForm.$invalid)return;this.isLoading=!0,this.$auth.loginWith("local",{data:this.smsForm}).then((function(){e.err_code=0,e.isOK=!0,e.$notify.success({message:"登录成功",title:"成功",timeout:1e3})})).catch((function(r){e.err_code=r.response.status,401===e.err_code&&-1!==r.response.data.err_msg.indexOf("邮箱")?e.$router.push("/validate_email?username=".concat(e.smsForm.username)):401===e.err_code&&-1!==r.response.data.err_msg.indexOf("手机")&&e.$router.push("/validate_phone?username=".concat(e.smsForm.username))})).then((function(){e.isLoading=!1}))}}}},m=t(7),component=Object(m.a)(n,(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("sui-grid",[t("sui-grid-column",{attrs:{computer:7,tablet:10,mobile:16,centered:""}},[t("sui-button-group",{attrs:{attached:"top"}},[t("sui-button",{attrs:{color:e.passLogin?"blue":"grey",basic:""},on:{click:function(r){e.passLogin=!0}}},[e._v("密码登录")]),e._v(" "),t("sui-button",{attrs:{color:e.passLogin?"grey":"blue",basic:""},on:{click:function(r){e.passLogin=!1}}},[e._v("免密码登陆")])],1),e._v(" "),t("sui-segment",{attrs:{attached:""}},[e.passLogin?t("sui-form",{attrs:{id:"form",method:"post",autocomplete:"off"},on:{submit:function(r){return r.preventDefault(),e.login.apply(null,arguments)}}},[t("sui-form-field",{attrs:{error:!(!e.$v.form.username.$error&&!e.err_code)}},[t("sui-input",{ref:"username",attrs:{disabled:e.isLoading||e.isOK,"icon-position":"left",icon:"user",placeholder:"用户名或11位手机号"},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}})],1),e._v(" "),t("sui-form-field",{attrs:{error:!(!e.$v.form.password.$error&&!e.err_code)}},[t("sui-input",{attrs:{disabled:e.isLoading||e.isOK,"icon-position":"left",icon:"lock",placeholder:"密码",type:"password"},model:{value:e.form.password,callback:function(r){e.$set(e.form,"password",r)},expression:"form.password"}})],1),e._v(" "),t("sui-form-fields",{attrs:{fields:2}},[t("sui-form-field",[t("sui-button",{attrs:{fluid:"",disabled:e.isLoading||e.isOK,loading:e.isLoading,icon:e.isOK?"check":"none",color:e.isOK?"green":"blue"}},[e.isOK?e._e():t("span",[e._v("登录")])])],1),e._v(" "),t("sui-form-field",[t("sui-button",{tag:"nuxt-link",attrs:{fluid:"",to:"/register"}},[e._v("注册")])],1)],1),e._v(" "),e.$v.form.username.$error||e.$v.form.password.$error?t("sui-form-field",{staticStyle:{"text-align":"center"}},[t("sui-message",{attrs:{negative:"",content:"用户名或者密码不能为空"}})],1):e._e()],1):t("sui-form",{attrs:{id:"form",method:"post",autocomplete:"off"},on:{submit:function(r){return r.preventDefault(),e.login.apply(null,arguments)}}},[t("sui-form-field",{attrs:{error:!!(e.$v.smsForm.username.$error||e.err_code||e.sms_err_code),inline:""}},[t("sui-input",{ref:"username",staticStyle:{width:"50%"},attrs:{disabled:e.isLoading||e.isOK,"icon-position":"left",icon:"phone",placeholder:"11位手机号"},model:{value:e.smsForm.username,callback:function(r){e.$set(e.smsForm,"username",r)},expression:"smsForm.username"}}),e._v(" "),t("sui-button",{tag:"div",attrs:{disabled:e.smsSend,color:"blue"},on:{click:function(r){return e.sendSMSCode()}}},[e._v(e._s(e.smsContent))])],1),e._v(" "),t("sui-form-field",{attrs:{error:!(!e.$v.smsForm.password.$error&&!e.err_code)}},[t("sui-input",{attrs:{disabled:e.isLoading||e.isOK,"icon-position":"left",icon:"edit",placeholder:"验证码"},model:{value:e.smsForm.password,callback:function(r){e.$set(e.smsForm,"password",r)},expression:"smsForm.password"}})],1),e._v(" "),t("sui-form-fields",{attrs:{fields:2}},[t("sui-form-field",[t("sui-button",{attrs:{fluid:"",disabled:e.isLoading||e.isOK,loading:e.isLoading,icon:e.isOK?"check":"none",color:e.isOK?"green":"blue"}},[e.isOK?e._e():t("span",[e._v("登录")])])],1),e._v(" "),t("sui-form-field",[t("sui-button",{tag:"nuxt-link",attrs:{fluid:"",to:"/register"}},[e._v("注册")])],1)],1),e._v(" "),e.$v.smsForm.username.$error||e.$v.smsForm.password.$error?t("sui-form-field",{staticStyle:{"text-align":"center"}},[t("sui-message",{attrs:{negative:"",content:"用户名或者密码不能为空"}})],1):e._e()],1)],1),e._v(" "),t("sui-container",{attrs:{"text-align":"center"}},[e._v(" 忘记密码？"),t("nuxt-link",{attrs:{to:"/forget_password"}},[e._v("点击这里")])],1)],1)],1)}),[],!1,null,null,null);r.default=component.exports}}]);