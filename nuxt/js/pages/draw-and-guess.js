(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{894:function(e,t,n){"use strict";n.r(t);var r=n(6),o=(n(29),n(12),{auth:!1,head:function(){return{title:"你画我猜 - Saiblo"}},data:function(){return{web_socket:null,server:{open:!1,timeout:null,closing:!1},content:{enabled:!1,group:"",admin:!1,data:[]},token:"",answer:"",adminAnswer:""}},methods:{clearWebSocket:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==e.server.timeout&&(clearTimeout(e.server.timeout),e.server.timeout=null),null===e.web_socket){t.next=11;break}return e.server.open=!1,e.server.closing=!0,t.next=6,e.web_socket.close();case 6:if(!e.server.closing){t.next=11;break}return t.next=9,new Promise((function(e){return setTimeout(e,10)}));case 9:t.next=6;break;case 11:case"end":return t.stop()}}),t)})))()},initWebSocket:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.clearWebSocket();case 2:e.server.open=!0,e.web_socket=new WebSocket("wss://api.saiblo.net/lottery/0/dag/".concat(e.token)),e.web_socket.onmessage=function(t){var n=JSON.parse(t.data);e.content=n,e.content.admin&&""===e.adminAnswer&&void 0!==n.answer&&(e.adminAnswer=n.answer)},e.web_socket.onclose=function(){e.web_socket=null,e.server.open&&e.content.group.length>0&&(e.server.timeout=setTimeout((function(){e.initWebSocket()}),3e3)),e.server.closing=!1};case 6:case"end":return t.stop()}}),t)})))()},sendMessage:function(e,t){this.web_socket.send(JSON.stringify({token:this.token,action:e,payload:t}))}}}),c=n(7),component=Object(c.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("sui-grid",{staticStyle:{"margin-left":"-1em !important","margin-right":"-1em !important"},attrs:{stackable:""}},[n("sui-grid-row",[n("sui-grid-column",[n("sui-header",{tag:"h1"},[e._v("你画我猜")])],1)],1),e._v(" "),n("sui-grid-row",{staticClass:"f",staticStyle:{"flex-direction":"row-reverse"}},[n("sui-grid-column",{attrs:{width:4}},[n("sui-form",[n("sui-form-field",[n("sui-message",{class:"f sa",staticStyle:{"margin-bottom":"0","border-bottom-left-radius":"0","border-bottom-right-radius":"0"},attrs:{size:"mini"}},[e.web_socket&&1===e.web_socket.readyState?n("div",[e._v("已连接服务器")]):e.web_socket&&0===e.web_socket.readyState?n("div",[e._v("正在连接服务器")]):n("div",[e._v("未连接服务器")])]),e._v(" "),n("sui-progress",{attrs:{attached:"",state:"active",percent:"100",color:e.web_socket?1===e.web_socket.readyState?"green":0===e.web_socket.readyState?"yellow":"grey":"grey"}}),e._v(" "),e.content.group.length>0?n("sui-message",{class:"f sa",staticStyle:{"margin-bottom":"0","border-bottom-left-radius":"0","border-bottom-right-radius":"0"},attrs:{size:"mini"}},[n("div",[e._v("小组："+e._s(e.content.group))])]):e._e(),e._v(" "),e.content.group.length>0?n("sui-progress",{attrs:{attached:"",state:"active",percent:"100",color:"green"}}):e._e(),e._v(" "),n("sui-message",{class:"f sa",staticStyle:{"margin-bottom":"0","border-bottom-left-radius":"0","border-bottom-right-radius":"0"},attrs:{size:"mini"}},[e.content.enabled?n("div",[e._v("比赛进行中")]):n("div",[e._v("比赛尚未开始")])]),e._v(" "),n("sui-progress",{attrs:{attached:"",state:"active",percent:"100",color:e.content.enabled?"green":"grey"}})],1),e._v(" "),e.content.admin?n("sui-form-field",[n("div",{staticClass:"ui action input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.adminAnswer,expression:"adminAnswer"}],attrs:{placeholder:"输入标准答案"},domProps:{value:e.adminAnswer},on:{input:function(t){t.target.composing||(e.adminAnswer=t.target.value)}}})])]):e._e(),e._v(" "),e.content.admin?n("sui-form-field",[n("sui-button",{attrs:{color:"blue",fluid:"",disabled:e.content.enabled||0===e.content.data.length},on:{click:function(t){return t.preventDefault(),e.sendMessage("clear")}}},[e._v("清空 ")])],1):e._e(),e._v(" "),e.content.admin?n("sui-form-field",[n("sui-button",{attrs:{color:"blue",fluid:"",disabled:e.content.enabled||0===e.adminAnswer.length},on:{click:function(t){return t.preventDefault(),e.sendMessage("start",e.adminAnswer)}}},[e._v("开始 ")])],1):e._e(),e._v(" "),e.content.admin?n("sui-form-field",[n("sui-button",{attrs:{color:"blue",fluid:"",disabled:!e.content.enabled},on:{click:function(t){return t.preventDefault(),e.sendMessage("stop")}}},[e._v("停止")])],1):e._e()],1)],1),e._v(" "),n("sui-grid-column",{attrs:{width:12}},[n("sui-form",[n("sui-form-field",[n("div",{staticClass:"ui action input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.token,expression:"token"}],staticStyle:{width:"0"},attrs:{placeholder:"在这里填入你的密钥"},domProps:{value:e.token},on:{input:function(t){t.target.composing||(e.token=t.target.value)}}}),e._v(" "),n("sui-button",{attrs:{color:"green",disabled:0===e.token.length||null!==e.web_socket},on:{click:function(t){return t.preventDefault(),e.initWebSocket()}}},[e._v("连接服务器 ")])],1)])],1),e._v(" "),e.content.group.length>0&&0===e.content.data.length?n("sui-message",{attrs:{icon:"exclamation",header:"还没有人猜呢，快来给出你的答案吧！",info:""}}):e._e(),e._v(" "),e.content.group.length>0&&e.content.data.length>0?n("sui-table",{attrs:{striped:""}},[n("sui-table-header",[n("sui-table-row",[n("sui-table-header-cell",[e._v("队名")]),e._v(" "),n("sui-table-header-cell",[e._v("答案")]),e._v(" "),n("sui-table-header-cell",{staticStyle:{width:"6em","text-align":"center"}},[e._v("猜中")])],1)],1),e._v(" "),n("transition-group",{attrs:{tag:"sui-table-body",name:"room_list"}},e._l(e.content.data,(function(t){var r=t.answer,o=t.name,c=t.correct;return n("sui-table-row",{key:o},[n("sui-table-cell",[e._v(e._s(o))]),e._v(" "),n("sui-table-cell",[e._v(e._s(r))]),e._v(" "),n("sui-table-cell",[c?n("sui-button",{attrs:{size:"mini",color:"green"}},[e._v("猜中")]):e._e()],1)],1)})),1)],1):e._e(),e._v(" "),e.content.group.length>0&&!e.content.admin?n("sui-form",[n("sui-form-field",[n("div",{staticClass:"ui action input"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],staticStyle:{width:"0"},attrs:{placeholder:"在这里写下你的答案"},domProps:{value:e.answer},on:{input:function(t){t.target.composing||(e.answer=t.target.value)}}}),e._v(" "),n("sui-button",{attrs:{color:"green",disabled:0===e.answer.length||e.answer.length>=20||!e.content.enabled||e.content.data.some((function(t){return t.user===e.answer}))},on:{click:function(t){return t.preventDefault(),e.web_socket.send(e.answer)}}},[e._v("提交\n                            ")])],1)])],1):e._e()],1)],1)],1)],1)}),[],!1,null,"1a3b9843",null);t.default=component.exports}}]);